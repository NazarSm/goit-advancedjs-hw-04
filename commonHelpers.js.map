{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst API_KEY = '42430851-e611567fbd1b8d73c000ca0dd';\nconst API_URL = 'https://pixabay.com/api/';\n\nconst searchForm = document.getElementById('search-form');\nconst gallery = document.querySelector('.gallery');\nconst loader = document.querySelector('.loader');\n\nlet itemsCount = 0;\nlet fetchedItemCount = 0;\nlet page = 1;\nlet searchValue = '';\nlet isLoading = false;\n\nconst lightbox = new SimpleLightbox(\".photo_link\");\n\nconst showError = (error) => {\n  loader.classList.add('visually-hidden');\n\n  isLoading = false;\n\n  iziToast.error({ message: error.message });\n};\n\nconst showCards = (data) => {\n  const markup = data.map((\n    {\n      webformatURL,\n      largeImageURL,\n      tags,\n      likes,\n      views,\n      comments,\n      downloads,\n    }) => `\n    <div class='photo-card'>\n      <a class='photo_link' href='${largeImageURL}'>\n        <img class='photo' src='${webformatURL}' alt='${tags}' loading='lazy' />\n      </a>\n      <div class='info'>\n        <div class='info-item'>\n          <b>Likes</b>\n          <p>${likes}</p>\n        </div>\n        <div class='info-item'>\n          <b>Views</b>\n           <p>${views}</p>\n        </div>\n        <div class='info-item'>\n          <b>Comments</b>\n          <p>${comments}</p>\n        </div>\n        <div class='info-item'>\n          <b>Downloads</b>\n          <p>${downloads}</p>\n        </div>\n      </div>\n    </div>\n  `).join('');\n\n  fetchedItemCount += data.length;\n\n  gallery.insertAdjacentHTML('beforeend', markup);\n\n  lightbox.refresh();\n}\n\nconst resetParams = ()  =>{\n  page = 1;\n  searchValue = '';\n  itemsCount = 0;\n  fetchedItemCount = 0;\n\n  gallery.textContent = '';\n};\n\nconst handleSubmit = async (event) => {\n  event.preventDefault();\n\n  resetParams();\n\n  searchValue = event.target.elements.searchQuery.value.trim();\n\n  if (!searchValue) {\n    searchForm.reset();\n\n    return;\n  }\n\n  loader.classList.remove('visually-hidden');\n\n  isLoading = true;\n\n  try {\n    const response = await fetchImages(searchValue, page);\n    const imageData = response.data;\n\n    itemsCount = imageData.totalHits;\n\n    if (!itemsCount) {\n      iziToast.error({\n        message: 'Sorry, there are no images matching your search query. Please try again.',\n      });\n    }\n\n    showCards(imageData.hits);\n\n    loader.classList.add('visually-hidden');\n\n    isLoading = false;\n\n    window.addEventListener('scroll', handleScroll);\n  } catch (error) {\n    showError(error);\n  }\n};\n\nconst handleScroll = async () => {\n  const isBottom = window.scrollY + window.innerHeight >=\n    document.documentElement.scrollHeight;\n\n  if (!isBottom || isLoading) {\n    return;\n  }\n\n  if (itemsCount < fetchedItemCount) {\n    window.removeEventListener('scroll', handleScroll);\n\n    gallery.insertAdjacentHTML(\n      'beforeend',\n      \"<p>We're sorry, but you've reached the end of search results.</p>\",\n    );\n\n    return;\n  }\n\n  page++;\n\n  loader.classList.remove('visually-hidden');\n\n  isLoading = true;\n\n  try {\n    const response = await fetchImages(\n      searchValue,\n      page,\n    );\n\n    showCards(response.data.hits);\n\n    isLoading = false;\n\n    loader.classList.add('visually-hidden');\n\n    const { height: cardHeight } = gallery\n      .firstElementChild\n      .getBoundingClientRect();\n\n    window.scrollBy({ top: cardHeight * 2, behavior: \"smooth\" });\n  } catch (error) {\n    showError(error);\n  }\n\n};\n\nsearchForm.addEventListener('submit', handleSubmit);\n\nconst pixabay = axios.create({\n  baseURL: API_URL,\n});\n\nconst fetchImages = (q, page) => {\n  const searchParams = new URLSearchParams({\n    key: API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 40,\n    page,\n    q,\n  });\n\n  return pixabay.get(`?${searchParams}`);\n}\n"],"names":["API_KEY","API_URL","searchForm","gallery","loader","itemsCount","fetchedItemCount","page","searchValue","isLoading","lightbox","SimpleLightbox","showError","error","iziToast","showCards","data","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","resetParams","handleSubmit","event","imageData","fetchImages","handleScroll","response","cardHeight","pixabay","axios","q","searchParams"],"mappings":"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"}